{% extends 'base.html.twig' %}

{% block title %}Profil - Placeaupro{% endblock %}

{% block body_class %}profile-page{% endblock %}

{# Navigation blanche #}
{% block nav_style %}white{% endblock %}

{# Pas de CSS responsive pour cette page #}
{% block responsive_css %}{% endblock %}

{% block content %}
    {# Banner du profil #}
    <section class="profile-banner">
        <div class="profile-banner-gradient"></div>
        <div class="profile-pic-container">
            <div class="profile-pic"
                 {% if user.avatar is defined and user.avatar %}
                 style="background-image: url('{{ asset(user.avatar) }}')"
                 {% endif %}>
            </div>
        </div>
    </section>

    {# Nom d'utilisateur #}
    <section class="profile-username">
        <h1 class="profile-name">{{ user.username|default('Pseudonim') }}</h1>
    </section>

    {# Boutons d'édition #}
    <section class="profile-actions">
        {% if app.user and app.user.id == user.id|default(null) %}
            <a href="{{ path('app_profile_edit') }}" class="btn-edit-profile">Edit profil</a>
        {% else %}
            <button class="btn-edit-profile btn-follow" data-user-id="{{ user.id|default(1) }}">Suivre</button>
        {% endif %}
        <button class="btn-more"><i class="fas fa-ellipsis-h"></i></button>
    </section>

    {# Sections du profil #}
    <section class="profile-sections">
        {% set sections = ['Tableau', 'Epingle', 'Service', 'About'] %}
        {% for section in sections %}
            <button class="section-btn{% if loop.first %} active{% endif %}" 
                    data-section="{{ section|lower }}">
                {{ section }}
            </button>
        {% endfor %}
    </section>

    <hr class="section-divider">

    {# Grille des tableaux #}
    <section class="profile-board-grid">
        {% for board in boards|default([]) %}
            <div class="profile-board-card" 
                 {% if board.cover is defined %}style="background-image: url('{{ asset(board.cover) }}')"{% endif %}>
                {% if board.title is defined %}
                    <span>{{ board.title }}</span>
                {% endif %}
            </div>
        {% else %}
            {# État par défaut - premier tableau à créer #}
            <div class="profile-board-card create-first">
                <span>Créer ton premier tableau</span>
            </div>
            {# Placeholders vides #}
            {% for i in 1..5 %}
                <div class="profile-board-card"></div>
            {% endfor %}
        {% endfor %}
    </section>

    {# Section Épingles (cachée par défaut) #}
    <section class="profile-pins-grid" style="display: none;">
        {% for pin in pins|default([]) %}
            <div class="profile-pin-card">
                <img src="{{ asset(pin.image) }}" alt="{{ pin.title }}">
            </div>
        {% endfor %}
    </section>

    {# Section Services (cachée par défaut) #}
    <section class="profile-services" style="display: none;">
        {% for service in services|default([]) %}
            <div class="service-card">
                <h3>{{ service.title }}</h3>
                <p>{{ service.description }}</p>
                <span class="price">{{ service.price|number_format(2, ',', ' ') }} €</span>
            </div>
        {% endfor %}
    </section>

    {# Section About (cachée par défaut) #}
    <section class="profile-about" style="display: none;">
        <div class="about-content">
            <p>{{ user.bio|default('Aucune biographie pour le moment.') }}</p>
        </div>
    </section>
{% endblock %}

{% block javascripts %}
<script>
    // Gestion des onglets du profil
    document.querySelectorAll('.section-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            // Retirer la classe active de tous les boutons
            document.querySelectorAll('.section-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            // Cacher toutes les sections
            document.querySelectorAll('.profile-board-grid, .profile-pins-grid, .profile-services, .profile-about')
                .forEach(section => section.style.display = 'none');
            
            // Afficher la section correspondante
            const sectionName = this.dataset.section;
            const sectionMap = {
                'tableau': '.profile-board-grid',
                'epingle': '.profile-pins-grid',
                'service': '.profile-services',
                'about': '.profile-about'
            };
            
            const targetSection = document.querySelector(sectionMap[sectionName]);
            if (targetSection) {
                targetSection.style.display = sectionName === 'about' || sectionName === 'service' ? 'block' : 'grid';
            }
        });
    });
</script>
{% endblock %}
